@model ShafaHRCoreLib.Models.Page
@using ShafaHRCoreLib.Models;
@using ShafaHRCoreLib.Managers;

@{
    ViewBag.Title = "سامانه ملی استفاده تحت نظارت محصولات پیشرفته درمانی";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container">
    <div class="row">
        <div class="col-sm-12">
            <div class="card-box table-responsive" style="padding: 30px">

                <div class="row">
                    <div class="col-md-12" style="padding:15px;background-color: #367656">
                        <span style="font-size: 14pt;color: #fff"> ویرایش صفحات </span>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md 12" style="height:10px">
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12 text-center">
                        <form method="post">
                            @Html.ValidationSummary(false, "", new { @class = "text-danger" })
                            @Html.AntiForgeryToken()
                            @Html.HiddenFor(model => model.Id)
                            <span style="color: green" class="text-center">@ViewBag.Message</span>
                            <div class="form-group">
                                @Html.LabelFor(model => model.Title, htmlAttributes: new { @class = "control-label col-md-2" })
                                <div class="col-md-10">
                                    @Html.EditorFor(model => model.Title, new { htmlAttributes = new { @class = "form-control" } })
                                    @Html.ValidationMessageFor(model => model.Title, "", new { @class = "text-danger" })
                                </div>
                            </div>

                            <div class="form-group" style="padding-top: 10px">
                                @Html.LabelFor(model => model.BodyHTML, htmlAttributes: new { @class = "control-label col-md-2" })
                                <div class="col-md-10">
                                    <textarea id="elm1" name="area" asp-for="BodyHTML"></textarea>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="col-md-12 text-left">
                                    <button type="submit" class="btn btn-success waves-effect waves-light">ثبت</button>
                                    <a class="btn btn-default waves-effect waves-light" href="@Url.Action("Index", "Page")">برگشت</a>
                                    <br />

                                </div>
                            </div>

                        </form>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>


@section scripts
{
    <!--form wysiwig js-->
    <script src="/assets/plugins/tinymce/tinymce.min.js"></script>

    <script type="text/javascript">
        $(document).ready(function () {
            if($("#elm1").length > 0){
                tinymce.init({
                    selector: "textarea#elm1",
                    theme: "modern",
                    height:300,
                    directionality: 'rtl',
                    menubar: false,
                    plugins: 'image link media code',
                    // toolbar: "rtl insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image | print preview media fullpage | file | code | forecolor backcolor emoticons",
                    toolbar: 'rtl undo redo | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image | file | code | print preview media fullpage',

                    images_upload_url: '/Page/File',
                    automatic_uploads: true,
                    file_picker_types: 'file image',

                    file_picker_callback: function (callback, value, meta) {

                        const input = document.createElement('input');
                        input.type = 'file';

                        if (meta.filetype === 'image') {
                            input.accept = 'image/*';
                        } else {
                            input.accept = '.pdf';
                        }

                        // input.onchange = function () {
                        //     const file = input.files[0];
                        //     const reader = new FileReader();
                        //     reader.onload = function () {
                        //         callback(reader.result, { text: file.name });
                        //     };
                        //     reader.readAsDataURL(file);
                        // };


                        input.onchange = function () {
                            const file = input.files[0];
                            const formData = new FormData();
                            formData.append('file', file);

                            fetch('/Page/File', {
                                method: 'POST',
                                body: formData
                            })
                            .then(r => r.json())
                            .then(result => {
                                callback(result.location, {
                                    text: file.name
                                });
                            });
                        };

                        input.click();
                    },

                    style_formats: [
                        {title: 'Bold text', inline: 'b'},
                        {title: 'Red text', inline: 'span', styles: {color: '#ff0000'}},
                        {title: 'Red header', block: 'h1', styles: {color: '#ff0000'}},
                        {title: 'Example 1', inline: 'span', classes: 'example1'},
                        {title: 'Example 2', inline: 'span', classes: 'example2'},
                        {title: 'Table styles'},
                        {title: 'Table row 1', selector: 'tr', classes: 'tablerow1'}
                    ]
                });
            }
        });
    </script>


}





